openapi: 3.1.0
info:
  title: Assistant Migration API
  version: 0.1.0
paths:
  /migration/legacy/preview:
    get:
      summary: Preview legacy conversation migration
      operationId: previewMigration
      responses:
        '200':
          description: Preview stats
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalMessagesFound: { type: integer }
                  estimatedDurationMs: { type: integer }
                  duplicateEstimate: { type: integer }
  /migration/legacy/execute:
    post:
      summary: Execute automatic migration
      operationId: executeMigration
      responses:
        '202':
          description: Migration started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationRecord'
  /migration/legacy/status/{id}:
    get:
      summary: Check migration status
      operationId: getMigrationStatus
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationRecord'
components:
  schemas:
    MigrationRecord:
      type: object
      properties:
        id: { type: string }
        source: { type: string }
        importedAt: { type: string, format: date-time }
        completedAt: { type: string, format: date-time }
        totalMessagesFound: { type: integer }
        totalMessagesImported: { type: integer }
        deduplicatedCount: { type: integer }
        status: { type: string, enum: [succeeded, failed, partial] }
        errorDetail: { type: string }
      required: [id, source, importedAt, totalMessagesFound, totalMessagesImported, deduplicatedCount, status]
